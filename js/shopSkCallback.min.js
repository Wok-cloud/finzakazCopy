window.shopSkCallback||(shopSkCallback=function(e){"use strict";var n=function(e){this.init(e)};return n.prototype={"_config":{"container":".js-sk-callback","block":".js-sk-callback-block","urlSave":"/skcallback/","yandexId":"","yandexOpen":"","yandexSend":"","yandexError":"","googleOpenCategory":"","googleOpenAction":"","googleSendCategory":"","googleSendAction":"","googleErrorCategory":"","googleErrorAction":""},"init":function(n){var a=this;if(a.params=e.extend({},a._config,n),a.initElements(),!a.elements.container.size())return!1;a.runSliders(),a.runMask(),a.onEventOpen(),a.onSubmit(),a.onClose()},"initElements":function(){var n=this,a={};a.container=e(n.params.container),a.block=e(n.params.block),a.sliders=a.container.find(".js-sk-callback-slider"),a.form=a.container.find(".js-sk-callback-form"),a.pole=a.container.find(".js-sk-callback__pole"),a.mask=a.container.find(".js-sk-callback-maskedinput"),a.preload=a.container.find(".js-sk-callback-preloader"),a.paramsRegion=a.container.find(".js-sk-callback-params-region"),a.paramsCity=a.container.find(".js-sk-callback-params-city"),a.captchaRefresh=a.container.find(".wa-captcha-refresh"),n.elements=a},"runSliders":function(){this.elements.sliders.each(function(){var n=e(this),a=n.closest(".js-sk-callback-pole-slider"),t=a.find(".js-sk-callback-input-min"),r=a.find(".js-sk-callback-input-max"),i=a.find(".js-sk-callback-value-min"),o=a.find(".js-sk-callback-value-max"),s=parseInt(n.data("min")),l=parseInt(n.data("max"));if(!s||!l)return!0;n.slider({"range":!0,"min":s,"max":l,"values":[s,l],"create":function(){n.find(".ui-slider-handle:first").text(s),n.find(".ui-slider-handle:last").text(l)},"slide":function(e,a){t.val(a.values[0]),r.val(a.values[1]),i.text(a.values[0]),o.text(a.values[1]),n.find(".ui-slider-handle:first").text(a.values[0]),n.find(".ui-slider-handle:last").text(a.values[1])}})})},"runMask":function(){this.elements.mask.each(function(){var n=e(this),a=/#/g,t=n.data("mask").replace(a,"9");t&&n.skmask(t)})},"onEventOpen":function(){var e=this;e.elements.block.on("event-open",function(){e.sendEventYandex(e.params.yandexOpen),e.sendEventGoogle(e.params.googleOpenCategory,e.params.googleOpenAction)})},"sendEventYandex":function(e){var n=this;if(n.params.yandexId&&e&&void 0!==window["yaCounter"+n.params.yandexId]){var a=window["yaCounter"+n.params.yandexId];void 0!==a&&void 0!==a.reachGoal&&a.reachGoal(e)}},"sendEventGoogle":function(e,n){e&&n&&"undefined"!=typeof ga&&ga("send","event",e,n)},"onSubmit":function(){var n=this,a=n.elements,t=!1;n.elements.form.on("submit",function(r){if(r.preventDefault(),t)return!1;t=!0,a.preload.show(),n.sendEventYandex(n.params.yandexSend),n.sendEventGoogle(n.params.googleSendCategory,n.params.googleSendAction),e.post(n.params.urlSave,n.elements.form.serialize()+"&check=1",function(r){a.pole.removeClass("_error"),"fail"==r.status?(e.each(r.errors,function(e,n){var t=a.pole.filter("[data-id='"+e+"']");t.size()&&(t.addClass("_error"),t.find(".js-sk-callback-error").text(n))}),a.captchaRefresh.size()&&a.captchaRefresh.click()):"ok"==r.status?n.elements.container.html(r.data.content):(alert("Произошла неизвестная ошибка"),n.sendEventYandex(n.params.yandexError),n.sendEventGoogle(n.params.googleErrorCategory,n.params.googleErrorAction)),a.preload.hide(),t=!1},"json")})},"onClose":function(){var e=this;e.elements.container.on("click",".js-sk-callback__close",function(){e.elements.block.trigger("run-close")})}},n}(jQuery)),void 0===jQuery.fn.skmask&&function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){var n,a=navigator.userAgent,t=/iphone/i.test(a),r=/chrome/i.test(a),i=/android/i.test(a);e.skmask={"definitions":{"9":"[0-9]","a":"[A-Za-z]","*":"[A-Za-z0-9]"},"autoclear":!0,"dataName":"rawMaskFn","placeholder":"_"},e.fn.extend({"caret":function(e,n){var a;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(n="number"==typeof n?n:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,n):this.createTextRange&&(a=this.createTextRange(),a.collapse(!0),a.moveEnd("character",n),a.moveStart("character",e),a.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,n=this[0].selectionEnd):document.selection&&document.selection.createRange&&(a=document.selection.createRange(),e=0-a.duplicate().moveStart("character",-1e5),n=e+a.text.length),{"begin":e,"end":n})},"unmask":function(){return this.trigger("unmask")},"skmask":function(a,o){var s,l,c,u,f,d,k,m;if(!a&&this.length>0){s=e(this[0]);var g=s.data(e.skmask.dataName);return g?g():void 0}return o=e.extend({"autoclear":e.skmask.autoclear,"placeholder":e.skmask.placeholder,"completed":null},o),l=e.skmask.definitions,c=[],u=k=a.length,f=null,e.each(a.split(""),function(e,n){"?"==n?(k--,u=e):l[n]?(c.push(new RegExp(l[n])),null===f&&(f=c.length-1),u>e&&(d=c.length-1)):c.push(null)}),this.trigger("unskmask").each(function(){function s(){if(o.completed){for(var e=f;d>=e;e++)if(c[e]&&R[e]===g(e))return;o.completed.call(A)}}function g(e){return o.placeholder.charAt(e<o.placeholder.length?e:0)}function p(e){for(;++e<k&&!c[e];);return e}function h(e){for(;--e>=0&&!c[e];);return e}function v(e,n){var a,t;if(!(0>e)){for(a=e,t=p(n);k>a;a++)if(c[a]){if(!(k>t&&c[a].test(R[t])))break;R[a]=R[t],R[t]=g(t),t=p(t)}C(),A.caret(Math.max(f,e))}}function b(e){var n,a,t,r;for(n=e,a=g(e);k>n;n++)if(c[n]){if(t=p(n),r=R[n],R[n]=a,!(k>t&&c[t].test(r)))break;a=r}}function y(){var e=A.val(),n=A.caret();if(m&&m.length&&m.length>e.length){for(w(!0);n.begin>0&&!c[n.begin-1];)n.begin--;if(0===n.begin)for(;n.begin<f&&!c[n.begin];)n.begin++;A.caret(n.begin,n.begin)}else{for(w(!0);n.begin<k&&!c[n.begin];)n.begin++;A.caret(n.begin,n.begin)}s()}function x(){w(),A.val()!=O&&A.change()}function j(e){if(!A.prop("readonly")){var n,a,r,i=e.which||e.keyCode;m=A.val(),8===i||46===i||t&&127===i?(n=A.caret(),a=n.begin,r=n.end,r-a==0&&(a=46!==i?h(a):r=p(a-1),r=46===i?p(r):r),S(a,r),v(a,r-1),e.preventDefault()):13===i?x.call(this,e):27===i&&(A.val(O),A.caret(0,w()),e.preventDefault())}}function E(n){if(!A.prop("readonly")){var a,t,r,o=n.which||n.keyCode,l=A.caret();if(!(n.ctrlKey||n.altKey||n.metaKey||32>o)&&o&&13!==o){if(l.end-l.begin!=0&&(S(l.begin,l.end),v(l.begin,l.end-1)),a=p(l.begin-1),k>a&&(t=String.fromCharCode(o),c[a].test(t))){if(b(a),R[a]=t,C(),r=p(a),i){var u=function(){e.proxy(e.fn.caret,A,r)()};setTimeout(u,0)}else A.caret(r);l.begin<=d&&s()}n.preventDefault()}}}function S(e,n){var a;for(a=e;n>a&&k>a;a++)c[a]&&(R[a]=g(a))}function C(){A.val(R.join(""))}function w(e){var n,a,t,r=A.val(),i=-1;for(n=0,t=0;k>n;n++)if(c[n]){for(R[n]=g(n);t++<r.length;)if(a=r.charAt(t-1),c[n].test(a)){R[n]=a,i=n;break}if(t>r.length){S(n+1,k);break}}else R[n]===r.charAt(t)&&t++,u>n&&(i=n);return e?C():u>i+1?o.autoclear||R.join("")===_?(A.val()&&A.val(""),S(0,k)):C():(C(),A.val(A.val().substring(0,i+1))),u?n:f}var A=e(this),R=e.map(a.split(""),function(e,n){return"?"!=e?l[e]?g(n):e:void 0}),_=R.join(""),O=A.val();A.data(e.skmask.dataName,function(){return e.map(R,function(e,n){return c[n]&&e!=g(n)?e:null}).join("")}),A.one("unskmask",function(){A.off(".skmask").removeData(e.skmask.dataName)}).on("focus.skmask",function(){if(!A.prop("readonly")){clearTimeout(n);var e;O=A.val(),e=w(),n=setTimeout(function(){A.get(0)===document.activeElement&&(C(),e==a.replace("?","").length?A.caret(0,e):A.caret(e))},10)}}).on("blur.skmask",x).on("keydown.skmask",j).on("keypress.skmask",E).on("input.skmask paste.skmask",function(){A.prop("readonly")||setTimeout(function(){var e=w(!0);A.caret(e),s()},0)}),r&&i&&A.off("input.skmask").on("input.skmask",y),w()})}})});