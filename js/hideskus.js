$.hideskusPlugin={inlineItem:"",inlineRow:"",locale:"",selectedClass:"selected",disabledClass:"hideskus-disabled",notExistClass:"hideskus-not-exist",disabledRadioClass:"hideskus-radio-disabled",hiddenOptionClass:"hideskus-option-hide",hideNotInStock:0,hideNonexistent:1,gotoVisible:1,delayStart:1,force:1,messages:{ru_RU:{Empty:"Отсутствует","Not in stock":"Нет в наличии"}},translate:function(e){return void 0!==this.messages[this.locale]&&this.messages[this.locale][e]?this.messages[this.locale][e]:e},init:function(e){this.hideNotInStock=void 0!==e&&void 0!==e.hide_not_in_stock?parseInt(e.hide_not_in_stock):0,this.hideNonexistent=void 0!==e&&void 0!==e.hide_not_existent?parseInt(e.hide_not_existent):1,this.gotoVisible=void 0!==e&&void 0!==e.go_to_available?parseInt(e.go_to_available):1,this.delayStart=void 0!==e&&void 0!==e.delay?parseInt(e.delay):1,this.delayStart&&($(document).on("change",".sku-feature",function(){this.delayStart=0}),setTimeout(function(){$.hideskusPlugin.delayStart&&$(".sku-feature").length&&$(".sku-feature:first").change()},1e3)),$(function(){var e=$('input:radio[name="sku_id"]');if(e.length){var i=0,s={},t={};e.each(function(){var e=$(this),a=e.closest("form").find("input[name='product_id']").val();if(e.prop("disabled")||1==e.data("disabled")){var l=e.closest("li").length?e.closest("li"):e.closest("div");$.hideskusPlugin.hideNotInStock?(l.hide(),e.is(":checked")&&(i=1)):l.addClass($.hideskusPlugin.disabledRadioClass).attr("title",$.hideskusPlugin.translate("Not in stock"))}else void 0===t[a]&&(s[a]=e,t[a]=1)}),(i||$.hideskusPlugin.gotoVisible)&&($.isEmptyObject(s)||setTimeout(function(){$.each(s,function(){$(this).click()})},800))}})},setOptions:function(e){this.inlineItem=void 0!==e&&void 0!==e.inlineItem?e.inlineItem:"",this.inlineRow=void 0!==e&&void 0!==e.inlineRow?e.inlineRow:"",this.selectedClass=void 0!==e&&void 0!==e.selectedClass?e.selectedClass:"selected",this.disabledClass=void 0!==e&&void 0!==e.disabledClass?e.disabledClass:"hideskus-disabled",this.disabledRadioClass=void 0!==e&&void 0!==e.disabledRadioClass?e.disabledRadioClass:"hideskus-radio-disabled"},start:function(e,i){function s(e,i){return i=i||!1,o.inlineItem&&e.closest(o.inlineItem).length?i?e.closest(o.inlineItem).siblings(o.inlineItem).andSelf():e.closest(o.inlineItem).siblings(o.inlineItem):o.inlineItem&&e.siblings(o.inlineItem).length?e.siblings(o.inlineItem):e.siblings("a").length?(o.inlineItem="a",e.siblings("a")):e.parent("label").length?(o.inlineItem="label",i?e.parent().siblings("label").andSelf():e.parent().siblings("label")):{}}function t(e,i){void 0===b[i=i||"disable"][e]&&(b[i][e]=0),b[i][e]++}function a(e,i){if(void 0===b[i=i||"disable"][e]){var s=0;for(var t in b[i])-1!==t.indexOf(e)&&(s+=b[i][t]);return s||-1}return b[i][e]}function l(e){return i.split(";").length!==e.split(";").length}function n(e,s,t){!l(e)&&i==e&&t&&(h.findVisible[e]={path:e,skuFeat:s}),h.skuFeat[s.id]={path:e,skuFeat:s}}function d(e,i){i?(void 0===e.attr("data-old-title")&&e.attr("data-old-title",void 0!==e.attr("title")?e.attr("title"):""),e.attr("title",i)):void 0!==e.attr("data-old-title")?e.attr("title",e.attr("data-old-title")):e.removeAttr("title")}var o=this,r=void 0!==e.form?e.form:void 0!==e.$form?e.$form:$(e).closest("form").length?$(e).closest("form"):"",u=void 0!==e.features?e.features:"undefined"!=typeof sku_features?sku_features:"";if(!r||!u)return console&&console.warn('Plugin "hideskus". \r\n'+(r?"":"Form not exists.")+(u?"":"Features not exist.")),!0;var f=(r=r instanceof jQuery?r:$(r)).find(".sku-feature:first"),c=f.data("feature-id")+":"+f.val()+";",h={findVisible:{},skuFeat:{}},v=0,p={},b={disable:{},hide:{}},C={},m={},k={};if(i=i||function(){var e="";return r.find(".sku-feature").each(function(){var i=$(this);e+=i.data("feature-id")+":"+i.val()+";"}),e}(),r.find(".sku-feature").each(function(e){var i,t=$(this),a=t.data("feature-id");if(void 0!==k[a])return!0;var l=t.is("input");if(k[a]=1,l){var n=t.siblings(".temp-block"),d=n.length?n:t.parent().find(".temp-block").length?t.parent().find(".temp-block"):"";d.length&&d.remove()}else t.prop("disabled",!1).find(".temp-block").remove();i={id:a,isInput:l,isRadio:t.is("input:radio"),fields:l?s(t,!0):t.find("option").length?t.find("option"):{}},0===e&&(C=i),m.children=i,m=i}),function e(s,r,f,c){var h=r,v=-1!==i.indexOf(h),b=!1;return p[c]=1,$.each(f.fields,function(C,m){var k=void 0!==(m=$(m)).data("value")?m.data("value"):f.isRadio?m.find("input").val():m.val();if(r+=f.id+":"+k+";",void 0!==f.children){var g=e(s,r,f.children,c+1);b||(p[c]=g.hideLimit),r+=g.key}var I=h+f.id+":"+k+";",x=a(I,"hide"),_=a(I)+(-1!==x?x:0),y=_>=p[c]&&v,O=x>=p[c]&&v,R=_<p[c]&&v,S=x<p[c]&&v,N=1==p[c]&&v;!l(I)&&!u[r]||O?(!O&&t(h,"hide"),(N||O)&&(o.hideNonexistent?m.addClass(o.notExistClass).addClass(o.disabledClass).hide():m.addClass(o.disabledClass).addClass(o.notExistClass),f.isInput||m.addClass(o.hiddenOptionClass),n(I,f,1))):y||u[r]&&!u[r].available?(!y&&t(h,o.hideNotInStock?"hide":"disable"),(N||y)&&(o.hideNotInStock?(m.hide(),f.isInput||m.addClass(o.hiddenOptionClass)):(m.removeClass(o.disabledClass).removeClass(o.notExistClass).show(),f.isInput||m.removeClass(o.hiddenOptionClass)),f.isInput?(m.addClass(o.disabledClass),d(m,$.hideskusPlugin.translate("Not in stock"))):(m.addClass(o.disabledClass).prop("disabled",!0),-1!==i.indexOf(I)&&m.closest("select").addClass(o.disabledClass)),n(I,f,o.hideNotInStock?1:o.gotoVisible?1:o.force?1:0))):(R||N||S)&&(f.isInput?(m.show().removeClass(o.disabledClass).removeClass(o.notExistClass),d(m)):(m.show().removeClass(o.disabledClass).removeClass(o.hiddenOptionClass).removeClass(o.notExistClass).prop("disabled",!1),-1!==i.indexOf(I)&&m.closest("select").removeClass(o.disabledClass))),r=h,b=!0}),{key:r,hideLimit:void 0!==f.children?p[c]*f.fields.length:f.fields.length}}(c,"",C,0),!$.isEmptyObject(h.findVisible))if(function(){if(!$.isEmptyObject(h.findVisible)){var e=function(i){function t(e){var i=e.split(";");for(var t in i)if(""!=i[t]){var a=i[t].split(":"),l=r.find(".sku-feature[name='features["+a[0]+"]']");if(l.is("input:radio")&&(l=r.find(".sku-feature[name='features["+a[0]+"]'][value='"+a[1]+"']")),l.is("input")){var n=o.inlineRow?l.closest(o.inlineRow):l.parent().parent(),d=s(l);if(d.removeClass(o.selectedClass),l.is("input:radio")?(n.find(".sku-feature").prop("checked",!1),l.prop("checked",!0)):(l.attr("value",a[1]),d.find("[data-value='"+a[1]+"']").addClass(o.selectedClass),d.filter("[data-value='"+a[1]+"']").addClass(o.selectedClass)),l.parent(".color").length){var u=l.parent(".color").find(".fa-check");if(u.length){var f=l.siblings("[data-value='"+a[1]+"']");f.find(".fa-check").length||(u.remove(),f.append('<i class="fa fa-check"></i>'))}}}else l.find("option").removeClass(o.selectedClass).prop("selected",!1).siblings("[value='"+a[1]+"']").addClass(o.selectedClass).prop("selected",!0),l.val(a[1])}}var a=i.substring(0,i.lastIndexOf(":")),n=2===a.split(":").length,d=null;if(""===a)return!1;for(var f in u)if(!l(f)&&-1!==f.indexOf(a)){if(u[f].available)return t(f),v=1,!1;null===d&&f!==i&&n&&(d=f)}return null===d||o.gotoVisible||o.force?e(a):(t(d),v=1,!1)};$.each(h.findVisible,function(i,s){e(s.path)})}}(),v){if(v)return f.change(),!1}else $.each(h.skuFeat,function(e,i){if(!i.skuFeat.fields.is(":visible")){var s=i.skuFeat.fields.first(),t=s.clone(),a=t.find("span").length?t.find("span"):t;t.addClass("temp-block "+o.disabledClass).css("display","inline-block"),""!==a.text()&&a.html($.hideskusPlugin.translate("Empty")),s.after(t.prop("outerHTML"))}});return o.force=0,!0}};